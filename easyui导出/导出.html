<!DOCTYPE html>
<html lang="zh-CN">
<head>
	<meta charset="UTF-8">
	<title>table export</title>
	<link rel="stylesheet" type="text/css" href="http://www.jeasyui.net/Public/js/easyui/themes/default/easyui.css">
    <link rel="stylesheet" type="text/css" href="http://www.jeasyui.net/Public/js/easyui/themes/icon.css">
    <script type="text/javascript" src="http://code.jquery.com/jquery-1.4.4.min.js"></script>
    <script type="text/javascript" src="http://www.jeasyui.net/Public/js/easyui/jquery.easyui.min.js"></script>
</head>
<body> 

<!-- 表里的Footer数据显示 showFooter: true-->
<div id="btn" style="border:1px solid #eee; width:100px; height:30px"> 
	<a data-type="xls" href="javascript:;">导出excel</a> 
</div>
<table  id="tt" class="easyui-datagrid" style="width:700px;height:450px"
       data-options="
	   rownumbers:true,
	   border:false,
	   pagination: true,
	   singleSelect:true,
	   url:'data/water.json',
	   method:'get',
	   toolbar:toolbar,
	   onLoadSuccess:onLoadSuccess,
	   styler:cellStyler,
	   showFooter: true
	   ">
 

    <!--固定列的-->
    <thead data-options="frozen:true">
    <tr>
        <th data-options="field:'addvcd',width:80">站名</th>
        <th data-options="field:'warn_stage',formatter:formatPrice,resizable:false" width="15%">警戒水位</th>
    </tr>
    </thead>
    <thead>
    <tr>
        <th data-options="field:'new_stage',width:380,align:'right',halign:'center'">List Price</th>
        <th data-options="field:'new_tm',width:180,align:'right'">Unit Cost</th>
        <th data-options="field:'max_stage',width:240">Attribute</th>
        <th data-options="field:'max_tm',width:260,align:'center',halign:'center'">Status</th>
        <th data-options="field:'new_stage',width:180,align:'right'">List Price</th>
        <th data-options="field:'new_tm',width:180,align:'right'">Unit Cost</th>
        <th data-options="field:'max_stage',width:240">Attribute</th>
        <th data-options="field:'max_tm',width:260,align:'center'">Status</th>
        <th data-options="field:'new_stage',width:180,align:'right',halign:'center'">List Price</th>
        <th data-options="field:'new_tm',width:180,align:'right'">Unit Cost</th>
        <th data-options="field:'max_stage',width:240">Attribute</th>
        <th data-options="field:'max_tm',width:260,align:'center'">Status</th>
    </tr>
    </thead>
 

</table>

<!-- 
	<table id="table2" border="1">
		<div class="thead">
			<div>
				<span>标题一</span>
				<span>标题二</span>
				<span>标题三</span>
				<span>标题四</span>
				<span>标题五</span>
			</div>
		</div>
		<tbody>
			<tr>
				<td><a href="http://w3cboy.com" target="_blank">文字</a></td>
				<td>咨询</td>
				<td>测试</td>
				<td>咨询</td>
				<td>测试</td>
			</tr>
			<tr>
				<td><a href="http://w3cboy.com" target="_blank">文字</a></td>
				<td>咨询</td>
				<td>测试</td>
				<td>咨询</td>
				<td>测试</td>
			</tr>
			<tr>
				<td><a href="http://w3cboy.com" target="_blank">文字</a></td>
				<td>咨询</td>
				<td>测试</td>
				<td>咨询</td>
				<td>测试</td>
			</tr>
			<tr>
				<td><a href="http://w3cboy.com" target="_blank">文字</a></td>
				<td>咨询</td>
				<td>测试</td>
				<td>咨询</td>
				<td>测试</td>
			</tr> 
			<tr>
				<td><a href="http://w3cboy.com" target="_blank">文字</a></td>
				<td>咨询</td>
				<td>测试</td>
				<td>咨询</td>
				<td>测试</td>
			</tr>
			<tr>
				<td><a href="http://w3cboy.com" target="_blank">文字</a></td>
				<td>咨询</td>
				<td>测试</td>
				<td>咨询</td>
				<td>测试</td>
			</tr>
			<tr>
				<td><a href="http://w3cboy.com" target="_blank">文字</a></td>
				<td>咨询</td>
				<td>测试</td>
				<td>咨询</td>
				<td>测试</td>
			</tr>
			<tr>
				<td><a href="http://w3cboy.com" target="_blank">文字</a></td>
				<td>咨询</td>
				<td>测试</td>
				<td>咨询</td>
				<td>测试</td>
			</tr> 
		</tbody>
	</table> -->
	  <table id="table2" border="1">
		<thead>
			<tr>
				<td >标题一</td>
				<td>标题二</td>
				<td>标题三</td>
				<td>标题四</td>
				<td>标题五</td>
			</tr>
		</thead>  
		<tbody>
			<tr>
				<td><a href="http://w3cboy.com" target="_blank">文字</a></td>
				<td>咨询</td>
				<td>测试</td>
				<td>咨询</td>
				<td>测试</td>
			</tr>
			<tr>
				<td><a href="http://w3cboy.com" target="_blank">文字</a></td>
				<td>咨询</td>
				<td>测试</td>
				<td>咨询</td>
				<td>测试</td>
			</tr>
			<tr>
				<td><a href="http://w3cboy.com" target="_blank">文字</a></td>
				<td>咨询</td>
				<td>测试</td>
				<td>咨询</td>
				<td>测试</td>
			</tr>
			<tr>
				<td><a href="http://w3cboy.com" target="_blank">文字</a></td>
				<td>咨询</td>
				<td>测试</td>
				<td>咨询</td>
				<td>测试</td>
			</tr> 
			<tr>
				<td><a href="http://w3cboy.com" target="_blank">文字</a></td>
				<td>咨询</td>
				<td>测试</td>
				<td>咨询</td>
				<td>测试</td>
			</tr>
			<tr>
				<td><a href="http://w3cboy.com" target="_blank">文字</a></td>
				<td>咨询</td>
				<td>测试</td>
				<td>咨询</td>
				<td>测试</td>
			</tr>
			<tr>
				<td><a href="http://w3cboy.com" target="_blank">文字</a></td>
				<td>咨询</td>
				<td>测试</td>
				<td>咨询</td>
				<td>测试</td>
			</tr>
			<tr>
				<td><a href="http://w3cboy.com" target="_blank">文字</a></td>
				<td>咨询</td>
				<td>测试</td>
				<td>咨询</td>
				<td>测试</td>
			</tr> 
		</tbody>
	</table> 
	<div id="export"> 
		<a data-type="xls" href="javascript:;">导出excel</a> 
	</div>
<!--<script src="Blob.js"></script>-->
	<script src="FileSaver.js"></script>
	<script src="tableExport.js"></script>
	<script>

	/**var $exportLink = document.getElementById('export');
	$exportLink.addEventListener('click', function(e){
		e.preventDefault();
		if(e.target.nodeName === "A"){
			tableExport('table2', '测试测试', e.target.getAttribute('data-type'));
		} 
	}, false);**/

	var btn = $('#export');
	btn.click(function(e){
		e.preventDefault();
		if(btn.children().get(0).tagName == "A"){
			tableExport('table2', '测试测试', btn.children().attr('data-type'));
		}  
	}, false);

	var btns = $('#btn');
	btns.click(function(e){
		e.preventDefault();
		if(btns.children().get(0).tagName == "A"){
			tableExport('tt', '文件名测试测试', btns.children().attr('data-type'));
		}  
	}, false); 

  //工具栏
    var toolbar = [
        {
            text: '导出',
            iconCls: 'icon-add',
            handler: function () {
                 alert('add')  
            }
        }, '-', {
            text: 'Cut',
            iconCls: 'icon-cut',
            handler: function () {
                alert('cut')
            }
        }, '-', {
            text: 'Save',
            iconCls: 'icon-save',
            handler: function () {
                alert('save')
            }
        }, '-', {
            text: 'search',
            iconCls: 'icon-search',
            handler: function () {
                alert('search');
            }
        }
    ];

    //单元格内数据处理
    function cellStyler(value, row, index) {
        if (value < 30) {
            return 'background-color:#ffee00;color:red;';
        }
    }
    //某列的数据处理
    function formatPrice(val, row) {
        if (val > 30) {
            return '<span style="color:pink;">(' + val + ')</span>';
        } else {
            return val;
        }
    }
    //搜索栏
   // 'load' 方法来加载新的数据网格（datagrid）数据。我们需要传递 'itemid' 和 'productid' 参数到服务器
    function doSearch() {
        $('#tt').datagrid('load', {
            addvcd: $('#addvcd').val(),
            productid: $('#addvcd').val()
        });
    }
    //合并单元格的
    function onLoadSuccess(data) {
        var merges = [{
            index: 2,
            rowspan: 2
        }, {
            index: 5,
            rowspan: 2
        }, {
            index: 7,
            rowspan: 2
        }];
        for (var i = 0; i < merges.length; i++) {
            $(this).datagrid('mergeCells', {
                index: merges[i].index,
                field: 'addvcd',
                rowspan: merges[i].rowspan
            });
        }
    }
	</script>
</body>
</html>